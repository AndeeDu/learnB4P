{
  "hash": "a37bf5a931d52111c7c56cc3d2da7c01",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"05 - Numeric predictors\"\nauthor: \"Stefano Coretta\"\nformat:\n  mono-light-revealjs:\n    theme: [default, custom.scss]\n    history: false\nfilters:\n  - tachyonsextra\nexecute:\n  echo: true\nknitr:\n  opts_chunk: \n    fig-align: center\n---\n\n\n\n\n## Set order of levels\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntoken_measures <- token_measures |> \n  mutate(\n    c2_phonation = factor(c2_phonation, levels = c(\"voiceless\", \"voiced\"))\n  )\n```\n:::\n\n\n\n## Vowel duration by speech rate\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/vdur-speech-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Numeric predictors\n\n$$\n\\begin{align}\nvdur_i & \\sim LogNormal(\\mu_i, \\sigma)\\\\\n\\mu_i & = \\beta_{1,voicing[i], language[i]} + \\beta_2 \\cdot \\text{spr_c}\\\\\n\\beta_{1jw} & \\sim Gaussian(\\mu_j, \\sigma_j) & , \\text{for } j = 1..2\\\\\n &  &  w = 1..2\\\\\n\\beta_2 & \\sim Gaussian(\\mu_3, \\sigma_3)\\\\\n\\sigma & \\sim Cauchy_{+}(0, \\sigma_4)\\\\\n\\end{align}\n$$\n\n## Centred speech rate\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/sr-centre-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n## Get default priors: indexing\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nget_prior(\n  v1_duration ~ 0 + c2_phonation:language + speech_rate_c,\n  family = lognormal,\n  data = token_measures\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                prior class                                  coef group resp\n               (flat)     b                                                 \n               (flat)     b    c2_phonationvoiced:languageItalian           \n               (flat)     b     c2_phonationvoiced:languagePolish           \n               (flat)     b c2_phonationvoiceless:languageItalian           \n               (flat)     b  c2_phonationvoiceless:languagePolish           \n               (flat)     b                         speech_rate_c           \n student_t(3, 0, 2.5) sigma                                                 \n dpar nlpar lb ub       source\n                       default\n                  (vectorized)\n                  (vectorized)\n                  (vectorized)\n                  (vectorized)\n                  (vectorized)\n             0         default\n```\n\n\n:::\n:::\n\n\n## Priors\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm_6_priors <- c(\n  # Priors for the four `b` coefficients\n  prior(normal(4.45, 0.275), class = b, coef = `c2_phonationvoiced:languageItalian`),\n  prior(normal(4.45, 0.275), class = b, coef = `c2_phonationvoiced:languagePolish`),\n  prior(normal(4.45, 0.275), class = b, coef = `c2_phonationvoiceless:languageItalian`),\n  prior(normal(4.45, 0.275), class = b, coef = `c2_phonationvoiceless:languagePolish`),\n  prior(normal(0, 0.5), class = b, coef = `speech_rate_c`),\n  # Prior for sigma\n  prior(normal(0, 0.1), class = sigma)\n)\n\nm_6_priors\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               prior class                                  coef group resp\n normal(4.45, 0.275)     b    c2_phonationvoiced:languageItalian           \n normal(4.45, 0.275)     b     c2_phonationvoiced:languagePolish           \n normal(4.45, 0.275)     b c2_phonationvoiceless:languageItalian           \n normal(4.45, 0.275)     b  c2_phonationvoiceless:languagePolish           \n      normal(0, 0.5)     b                         speech_rate_c           \n      normal(0, 0.1) sigma                                                 \n dpar nlpar   lb   ub source\n            <NA> <NA>   user\n            <NA> <NA>   user\n            <NA> <NA>   user\n            <NA> <NA>   user\n            <NA> <NA>   user\n            <NA> <NA>   user\n```\n\n\n:::\n:::\n\n\n## Prior predictive checks\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmy_seed <- 5293\n\nm_6_priorpp <- brm(\n  v1_duration ~ 0 + c2_phonation:language + speech_rate_c,\n  data = token_measures,\n  family = lognormal,\n  prior = m_6_priors,\n  sample_prior = \"only\",\n  cores = 4,\n  seed = my_seed,\n  file = \"data/cache/m_6_priorpp\"\n)\n```\n:::\n\n\n## Prior predictive plots: voicing and language\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nconditional_effects(m_6_priorpp, effects = \"language:c2_phonation\")\n```\n\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/m-5-prior-pp-plot-1-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Prior predictive plots: speech rate\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nconditional_effects(m_6_priorpp, effects = \"speech_rate_c\", spaghetti = TRUE, ndraws = 100)\n```\n\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/m-5-prior-pp-plot-2-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Fit the model\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm_6 <- brm(\n  v1_duration ~ 0 + c2_phonation:language + speech_rate_c,\n  data = token_measures,\n  family = lognormal,\n  prior = m_6_priors,\n  seed = my_seed,\n  cores = 4,\n  file = \"data/cache/m_6\"\n)\n```\n:::\n\n\n## Model summary\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(m_6, prob = 0.8)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: lognormal \n  Links: mu = identity; sigma = identity \nFormula: v1_duration ~ 0 + c2_phonation:language + speech_rate_c \n   Data: token_measures (Number of observations: 1342) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nRegression Coefficients:\n                                      Estimate Est.Error l-80% CI u-80% CI Rhat\nspeech_rate_c                            -0.19      0.01    -0.20    -0.18 1.00\nc2_phonationvoiceless:languageItalian     4.64      0.01     4.63     4.66 1.00\nc2_phonationvoiced:languageItalian        4.75      0.01     4.74     4.77 1.00\nc2_phonationvoiceless:languagePolish      4.35      0.02     4.33     4.37 1.00\nc2_phonationvoiced:languagePolish         4.44      0.02     4.42     4.46 1.00\n                                      Bulk_ESS Tail_ESS\nspeech_rate_c                             5154     3038\nc2_phonationvoiceless:languageItalian     6123     3140\nc2_phonationvoiced:languageItalian        5637     3156\nc2_phonationvoiceless:languagePolish      5510     3056\nc2_phonationvoiced:languagePolish         5625     3238\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-80% CI u-80% CI Rhat Bulk_ESS Tail_ESS\nsigma     0.23      0.00     0.22     0.24 1.00     5516     2817\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\n## Posterior probability distributions: outcome (vowel duration)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nconditional_effects(m_6, effects = \"language:c2_phonation\")\n```\n\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/m-6-cond-1-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Posterior probability distributions: outcome (vowel duration)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nconditional_effects(m_6, effects = \"speech_rate_c\")\n```\n\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/m-6-cond-2-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Posterior probability distribution: difference of vowel duration\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(marginaleffects)\n\n# In milliseconds\navg_comparisons(m_6, variables = \"c2_phonation\", by = \"language\", conf_level = 0.8)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n         Term                       Contrast language Estimate 10.0 % 90.0 %\n c2_phonation mean(voiced) - mean(voiceless)  Italian    12.76  10.46  15.00\n c2_phonation mean(voiced) - mean(voiceless)  Polish      6.94   4.78   9.15\n\nColumns: term, contrast, language, estimate, conf.low, conf.high, predicted_lo, predicted_hi, predicted, tmp_idx \nType:  response \n```\n\n\n:::\n\n```{.r .cell-code}\n# As ratio\navg_comparisons(m_6, variables = \"c2_phonation\", by = \"language\", conf_level = 0.8, comparison = \"ratio\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n         Term                       Contrast language Estimate 10.0 % 90.0 %\n c2_phonation mean(voiced) / mean(voiceless)  Italian     1.12   1.09   1.14\n c2_phonation mean(voiced) / mean(voiceless)  Polish      1.09   1.06   1.12\n\nColumns: term, contrast, language, estimate, conf.low, conf.high, predicted_lo, predicted_hi, predicted, tmp_idx \nType:  response \n```\n\n\n:::\n:::\n\n\n## Posterior probability distribution: difference of difference\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\navg_comparisons(m_6, variables = \"c2_phonation\", by = \"language\", conf_level = 0.8, comparison = \"ratio\", hypothesis = \"b2 = b1\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  Term Estimate  10.0 % 90.0 %\n b2=b1  -0.0243 -0.0605 0.0128\n\nColumns: term, estimate, conf.low, conf.high \nType:  response \n```\n\n\n:::\n:::\n\n\n## Posterior predictive checks\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npp_check(m_6, ndraws = 100)\n```\n\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/m-6-ppcheck-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Non-linear effect of speech rate\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/vdur-speech-2-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n## Non-linear effects: GAMs\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm_6a <- brm(\n  v1_duration ~ 0 + c2_phonation:language + s(speech_rate_c, k = 3),\n  data = token_measures,\n  family = lognormal,\n  seed = my_seed,\n  cores = 4,\n  file = \"data/cache/m_6a\"\n)\n```\n:::\n\n\n## Posterior probability distributions: outcome (vowel duration)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(conditional_effects(m_6a, effects = \"speech_rate_c\"), points = TRUE)\n```\n\n::: {.cell-output-display}\n![](05_numeric_files/figure-revealjs/m-6a-cond-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Posterior probability distribution: difference of difference\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\navg_comparisons(m_6a, variables = \"c2_phonation\", by = \"language\", conf_level = 0.8, comparison = \"ratio\", hypothesis = \"b2 = b1\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  Term Estimate  10.0 % 90.0 %\n b2=b1  -0.0195 -0.0562 0.0178\n\nColumns: term, estimate, conf.low, conf.high \nType:  response \n```\n\n\n:::\n:::",
    "supporting": [
      "05_numeric_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}